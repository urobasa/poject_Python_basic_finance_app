{% extends 'base.html' %}
{% block title %}–û–ø–µ—Ä–∞—Ü–∏–∏{% endblock %}

{% block content %}
<h2>–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>

<div class="d-flex justify-content-between align-items-center mb-3">
  <a href="{{ url_for('operations.create_operation_view') }}" class="btn btn-success">‚ûï –ù–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è</a>
  <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse" aria-expanded="false" aria-controls="filterCollapse">üîç –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
</div>

<div class="collapse mb-4 {% if request.args %}show{% endif %}" id="filterCollapse">
  <form method="get" class="row g-3">
  <div class="col-md-3">
    <label>–° –¥–∞—Ç—ã:</label>
    <input type="datetime-local" name="start_date" value="{{ request.args.get('start_date', '') }}" class="form-control">
  </div>
  <div class="col-md-3">
    <label>–ü–æ –¥–∞—Ç—É:</label>
    <input type="datetime-local" name="end_date" value="{{ request.args.get('end_date', '') }}" class="form-control">
  </div>
  <div class="col-md-2">
    <label>–°—É–º–º–∞ –æ—Ç:</label>
    <input type="number" step="0.01" name="amount_min" value="{{ request.args.get('amount_min', '') }}" class="form-control">
  </div>
  <div class="col-md-2">
    <label>–°—É–º–º–∞ –¥–æ:</label>
    <input type="number" step="0.01" name="amount_max" value="{{ request.args.get('amount_max', '') }}" class="form-control">
  </div>
  <div class="col-md-2">
    <label>–¢–∏–ø:</label>
    <select name="type" class="form-select">
      <option value="">–í—Å–µ</option>
      <option value="income" {% if request.args.get('type') == 'income' %}selected{% endif %}>–î–æ—Ö–æ–¥</option>
      <option value="expense" {% if request.args.get('type') == 'expense' %}selected{% endif %}>–†–∞—Å—Ö–æ–¥</option>
    </select>
  </div>
  <div class="col-md-3">
    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
    <select name="category_id" class="form-select">
      <option value="">–í—Å–µ</option>
      {% for category in categories %}
        <option value="{{ category.id }}" {% if request.args.get('category_id') == category.id|string %}selected{% endif %}>
          {{ category.name }}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3 align-self-end">
    <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    <a href="{{ url_for('operations.list_operations') }}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
  </div>
</form>
</div>


<table class="table table-striped">
    <thead>
        <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–°—É–º–º–∞</th>
            <th>–¢–∏–ø</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–°—á—ë—Ç</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
        </tr>
    </thead>
    <tbody>
        {% for op in operations %}
        <tr>
            <td>{{ op.datetime.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ op.amount }} ‚ÇΩ</td>
            <td>{{ "–†–∞—Å—Ö–æ–¥" if op.category.type == 'expense' else "–î–æ—Ö–æ–¥" }}</td>
            <td>{{ op.category.name }}</td>
            <td>{{ op.account.name }}</td>
            <td>{{ op.description or '' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>


{% endblock %}
            <option value="expense" {% if category and category.type == 'expense' %}selected{% endif %}>–†–∞—Å—Ö–æ–¥</option>
            <option value="income" {% if category and category.type == 'income' %}selected{% endif %}>–î–æ—Ö–æ–¥</option>
