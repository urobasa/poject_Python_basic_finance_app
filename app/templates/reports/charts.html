
{% block content %}
<button class="btn btn-outline-primary mb-3" type="button" data-bs-toggle="collapse"
        data-bs-target="#filterCollapse" aria-expanded="false" aria-controls="filterCollapse">
  üîç –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
</button>

<div class="collapse mb-4 {% if request.args %}show{% endif %}" id="filterCollapse">
  <form method="get" class="row g-3">
    <div class="col-md-3">
      <label>–° –¥–∞—Ç—ã:</label>
      <input type="date" name="start_date" value="{{ request.args.get('start_date', '') }}" class="form-control">
    </div>
    <div class="col-md-3">
      <label>–ü–æ –¥–∞—Ç—É:</label>
      <input type="date" name="end_date" value="{{ request.args.get('end_date', '') }}" class="form-control">
    </div>
    <div class="col-md-3 d-flex align-items-end gap-2">
      <button type="submit" class="btn btn-primary me-2">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      <a href="{{ url_for('reports.report_charts') }}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
    </div>
  </form>
</div>
<h2>üìä –î–∏–∞–≥—Ä–∞–º–º—ã</h2>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="row">
  <div class="col-md-6">
    <h5>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
    <canvas id="categoryChart"></canvas>
  </div>
  <div class="col-md-6">
    <h5>–î–æ—Ö–æ–¥—ã –∏ –†–∞—Å—Ö–æ–¥—ã</h5>
    <canvas id="typeChart"></canvas>
  </div>
</div>

<script>
const categoryData = {{ category_data | tojson }};
const typeData = {{ type_data | tojson }};

// –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
new Chart(document.getElementById('categoryChart'), {
    type: 'pie',
    data: {
        labels: categoryData.labels,
        datasets: [{
            label: '–°—É–º–º–∞',
            data: categoryData.data,
        }]
    }
});

// –°—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
new Chart(document.getElementById('typeChart'), {
    type: 'bar',
    data: {
        labels: ['–î–æ—Ö–æ–¥—ã', '–†–∞—Å—Ö–æ–¥—ã'],
        datasets: [{
            label: '–°—É–º–º–∞',
            data: [typeData.income, typeData.expense],
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
{% endblock %}
