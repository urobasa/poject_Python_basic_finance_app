{% extends 'reports/analytics_panel.html' %}
{% block analytics_content %}
<h2>üß† Data Science –ê–Ω–∞–ª–∏–∑</h2>
<!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
<form class="row g-3 mb-4" method="get">
<div class="col-md-3">
<label>–° –¥–∞—Ç—ã:</label>
<input class="form-control" name="start_date" type="date" value="{{ request.args.get('start_date', '') }}"/>
</div>
<div class="col-md-3">
<label>–ü–æ –¥–∞—Ç—É:</label>
<input class="form-control" name="end_date" type="date" value="{{ request.args.get('end_date', '') }}"/>
</div>
<div class="col-md-3 align-self-end d-flex gap-2">
<button class="btn btn-primary" type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
<a class="btn btn-secondary" href="{{ url_for('reports.report_analytics') }}">–°–±—Ä–æ—Å–∏—Ç—å</a>
</div>
</form>
<div class="row">
<div class="col-md-6">
<h5>–†–∞—Å—Ö–æ–¥—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏</h5>
    {% if chart %}
      <img class="img-fluid mb-3" src="data:image/png;base64,{{ chart }}"/>
    {% else %}
      <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞.</p>
    {% endif %}

        {% if stats %}
        <ul class="list-group mb-3 mt-3">
<li class="list-group-item"><strong>–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</strong> {{ stats.mean | round(2) }} ‚ÇΩ</li>
<li class="list-group-item"><strong>–ú–µ–¥–∏–∞–Ω–∞:</strong> {{ stats.median | round(2) }} ‚ÇΩ</li>
<li class="list-group-item"><strong>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:</strong> {{ stats.std | round(2) }} ‚ÇΩ</li>
<li class="list-group-item"><strong>–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏:</strong> {{ stats.anomalies|length }}</li>
</ul>
        {% if stats.anomalies %}
        <h6>–ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:</h6>
<ul>
          {% for op in stats.anomalies %}
          <li>{{ op.datetime.strftime('%Y-%m-%d') }} ‚Äî {{ op.amount }} ‚ÇΩ ({{ op.category.name }})</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% endif %}
        </div>
<div class="col-md-6">
<h5>–ü—Ä–æ–≥–Ω–æ–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ 30 –¥–Ω–µ–π</h5>
    {% if forecast_chart %}
      <img class="img-fluid mb-3" src="data:image/png;base64,{{ forecast_chart }}"/>
    {% else %}
      <p>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞.</p>
    {% endif %}
  </div>
</div>
{% endblock %}